<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="include :: header('æ–°å¢å•†å“ä¿¡æ¯')"/>
    <th:block th:include="include :: select2-css"/>
    <th:block th:include="include :: jquery-setSetp-css"/>
    <th:block th:include="include :: summernote-css"/>
    <style type="text/css">
        .ibox {
            border-radius: unset;
        }
        .ibox-content {
            border: none;
        }
        .del-radio-box {
            font-size: 10px;
        }
        .noCheck {
            padding-left: unset;
        }
        .dest-show {
            padding: 10px 20px;
            margin-top: 5px;
            background-color: #f8f8f8;
        }
		.video{
			max-height: 300px;
			max-width: 300px;
		}
		.posImgDel{
			width: 22px;
			height: 22px;
			position: absolute;
			right: -10px;
			top: -10px;
			cursor: pointer;
			border: 1px solid white;
			background-color: white;
			border-radius: 1000px;
			z-index: 99;
		}
    </style>
</head>
<body class="white-bg">
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
    <form class="form-horizontal wizard-big" id="form-pmsProduct-add" th:object="${pmsProduct}">
        <input name="id" class="form-control" type="hidden" th:field="*{id}">
        <!-- èœå•åŠåˆ†é¡µå®¹å™¨-->
        <div class="stepCont ">
            <!-- èœå•å¯¼èˆªæ˜¾ç¤º-->
            <div class="ystep-container ystep-lg ystep-blue"></div>
            <!--åˆ†é¡µå®¹å™¨-->
            <div class="pageCont">
                <!--æ­¥éª¤1-->
                <div id="page1" class="stepPage">
                    <div class="row" id="step-1">
                        <div class="form-group">
                            <label class="col-sm-3 control-label is-required">å•†å“åˆ†ç±»ï¼š</label>
                            <div class="col-sm-3">
                                <select class="form-control " name="productCategoryId"
                                        th:with="type=${@custom.getPmsCategory()}">
                                    <option value="">è¯·é€‰æ‹©</option>
                                    <option th:each="dict : ${type}" th:text="${dict.name}"
                                            th:field="*{productCategoryId}"
                                            th:value="${dict.id}"></option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label is-required">å•†å“åç§°ï¼š</label>
                            <div class="col-sm-6">
                                <input name="name" class="form-control" type="text" th:field="*{name}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label is-required">å‰¯æ ‡é¢˜ï¼š</label>
                            <div class="col-sm-6">
                                <input name="subTitle"  th:field="*{subTitle}" class="form-control" type="text">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label is-required">å•†å“å“ç‰Œï¼š</label>
                            <div class="col-sm-3">
                                <select name="brandId" class="form-control m-b" th:with="type=${@custom.getPmsBrand()}">
                                    <option value="">è¯·é€‰æ‹©</option>
                                    <option th:each="dict : ${type}" th:text="${dict.name}"
                                            th:field="*{brandId}"
                                            th:value="${dict.id}"></option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">æ¨èç±»å‹ï¼š</label>
                            <div class="col-sm-8">
                                <div class="radio-box" th:each="dict : ${@custom.recommendProductType()}">
                                    <input type="checkbox" th:id="${'recommendProductType_' + dict.key}"
                                           name="recommendProductType" th:value="${dict.key}">
                                    <label th:for="${'recommendProductType_' + dict.key}"
                                           th:text="${dict.value}"></label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label is-required">æ”¯ä»˜æ–¹å¼ï¼š</label>
                            <div class="col-sm-8">
                                <input id="paymentType" name="paymentType" class="form-control" type="hidden" th:field="*{paymentType}">
                                <div  style="width: 80%;">
                                    <input type="radio" name="paymentType0" value="1" id="paymentType1" checked><label>çº¿ä¸Šä»˜æ¬¾</label>
                                    <input type="radio" name="paymentType0" value="2" id="paymentType2" style="margin-left: 2%;"  ><label>è´§åˆ°ä»˜æ¬¾</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" id="deposit0">
                            <label class="col-sm-3 control-label"
                                   data-toggle="tooltip"
                                   data-placement="right"
                                   title="å®šé‡‘åœ¨å•†å“æ”¯ä»˜æ–¹å¼ä¸ºè´§åˆ°ä»˜æ¬¾æ—¶æ˜¾ç¤º.">å®šé‡‘ï¼š</label>
                            <div class="col-sm-6">
                                <input name="deposit" class="form-control" type="text" th:field="*{deposit}">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">å•†å“ä»‹ç»ï¼š</label>
                            <div class="col-sm-6">
                                <textarea name="description" th:field="*{description}" class="form-control" type="text"></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label"
                                   data-toggle="tooltip"
                                   data-placement="right"
                                   title="æŸ¥è¯¢å•†å“æ—¶,å¯é€šè¿‡å…³é”®å­—æŸ¥è¯¢åˆ°è¯¥å•†å“.">å…³é”®å­—ï¼š</label>
                            <div class="col-sm-6">
                                <input name="keywords" class="form-control" type="text" th:field="*{keywords}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label"
                                   data-toggle="tooltip"
                                   data-placement="right"
                                   title="">é”€é‡ï¼š</label>
                            <div class="col-sm-6">
                                <input name="keywords" class="form-control" type="text" th:field="*{sale}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label is-required"
                                   data-toggle="tooltip"
                                   data-placement="right"
                                   title="æ­¤ä»·æ ¼åœ¨å•†å“åˆ—è¡¨ä¸­æ˜¾ç¤º.å®é™…å”®å–ä»·æ ¼ä»¥å•†å“ä¸­ä¸åŒè§„æ ¼è®¾ç½®çš„ä»·æ ¼ä¸ºå‡†.">å•†å“ä»·æ ¼ï¼š</label>
                            <div class="col-sm-6">
                                <input name="price" class="form-control" type="text" th:field="*{price}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label is-required"
                                   data-toggle="tooltip"
                                   data-placement="right"
                                   title="æ­¤ä»·æ ¼åªåšæ˜¾ç¤º,å•†å“åˆ—è¡¨ä¸­ä»¥ä¸­åˆ’çº¿æ˜¾ç¤º.">å¸‚åœºä»·æ ¼ï¼š</label>
                            <div class="col-sm-6">
                                <input name="originalPrice" class="form-control" type="text" th:field="*{originalPrice}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label is-required">å•†å“æ’åºï¼š</label>
                            <div class="col-sm-6">
                                <input name="sort" class="form-control" type="text" value="99999" th:field="*{sort}">
                            </div>
                        </div>
                        <!--<div class="form-group">
                            <label class="col-sm-3 control-label is-required">è¿è´¹æ¨¡æ¿ï¼š</label>
                            <div class="col-sm-6">
                                <div class="input-group">
                                    <select name="feightTemplateId" class="form-control m-b" th:with="type=${@custom.feightTemplates()}">
                                        <option value="">è¯·é€‰æ‹©</option>
                                        <option th:each="dict : ${type}" th:text="${dict.name}" th:value="${dict.id}" th:field="*{feightTemplateId}"
                                                th:attr="data-free=${dict.freeDest},data-toll=${dict.tollDest},data-exclude=${dict.excludeDest}"></option>
                                    </select>
                                    <div class="dest-show hidden"></div>
                                </div>
                            </div>
                        </div>-->
                    </div>
                </div>
                <!--æ­¥éª¤2-->
                <div id="page2" class="stepPage">
                    <div class="row" id="step-2">

                        <div class="form-group">
                            <label class="col-sm-3 control-label is-required">å±æ€§ç±»å‹ï¼š</label>
                            <div class="col-sm-3">
                                <select name="productAttributeCategoryId" class="form-control m-b"
                                        th:with="type=${@custom.getPmsAttrCategory()}" id="pmsAttrCategory">
                                    <option value="">è¯·é€‰æ‹©</option>
                                    <option th:each="dict : ${type}" th:text="${dict.name}"
                                            th:field="*{productAttributeCategoryId}"
                                            th:value="${dict.id}"></option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label is-required">å•†å“è§„æ ¼ï¼š</label>
                            <div class="col-sm-6 ">
                                <div class=" " id="attrBox">


                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label is-required">æ“ä½œï¼š</label>
                            <div class="col-sm-6">
                                <button id="update_table" class="btn btn-success" type="button">åˆ·æ–°è§„æ ¼é¡¹ç›®è¡¨</button>
                            </div>
                        </div>

                        <!--skuåˆ—è¡¨ style="display: none;"-->
                        <div class="control-group form-group">
                            <label class="col-sm-3 control-label is-required">è§„æ ¼é¡¹ç›®è¡¨</label>
                            <div class="controls col-sm-6" id="lv_table_con">
                                <div id="lv_table">
                                    <!--è‡ªåŠ¨ç”Ÿæˆskuåˆ—è¡¨-->
                                </div>
                                <span class="help-block m-b-none" style="clear: both;"><i class="fa fa-info-circle"></i> è‡³å°‘æ·»åŠ ä¸€æ¡skuä¿¡æ¯.è‹¥skuå›¾ç‰‡ä¸ºç©ºåˆ™é»˜è®¤æ˜¾ç¤ºå•†å“ä¸»å›¾. </span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label is-required">å•†å“å‚æ•°ï¼š</label>
                            <div class="col-sm-6">
                                <div class="ibox">
                                    <div class="ibox-content" id="paramsBox">
                                        <!--å‚æ•°åˆ—è¡¨è‡ªåŠ¨ç”Ÿæˆ-->
                                    </div>
                                </div>
                                <span class="help-block m-b-none" style="clear: both;"><i class="fa fa-info-circle"></i> è‹¥å‚æ•°å€¼ä¸ºç©º,åˆ™è¯¥å‚æ•°é»˜è®¤å–æ¶ˆ. </span>
                            </div>
                        </div>
                    </div>
                </div>
                <!--æ­¥éª¤3-->
                <div id="page3" class="stepPage">
                    <div class="row" id="step-3">
                        <div class="form-group">
                            <label class="col-sm-3 control-label is-required">å•†å“ä¸»å›¾ï¼š</label>
                            <div class="col-sm-6">
                                <input name="pic" class="form-control" type="hidden" th:field="*{pic}">
                                <ul class="ft-uploader__files" id="picImg" style="margin-top: 10px;">
                                    <!-- å›¾ç‰‡å±•ç¤º -->
                                </ul>
                                <div class="ft-uploader__input-box" id="picBox">
                                    <button id="picBtn" type="button" class="ft-uploader__input"></button>
                                </div>
                                <span class="help-block m-b-none" style="clear: both;"><i class="fa fa-info-circle"></i> å•†å“åˆ—è¡¨ä¸­æ˜¾ç¤º </span>
                            </div>
                        </div>
						<div class="form-group">
						    <label class="col-sm-3 control-label">å•†å“è§†é¢‘ï¼š</label>
						    <div class="col-sm-6">
						        <input name="video" class="form-control" type="hidden" th:field="*{video}">
						        <ul class="ft-uploader__files" id="videoShow" style="margin-top: 10px;">
						            <!-- å›¾ç‰‡å±•ç¤º -->
						        </ul>
						        <div class="ft-uploader__input-box" id="videoBox">
						            <button id="videoBtn" type="button" class="ft-uploader__input"></button>
						        </div>
						        <span class="help-block m-b-none" style="clear: both;"><i class="fa fa-info-circle"></i> å•†å“è¯¦æƒ…ä¸­è½®æ’­å›¾ç¬¬ä¸€ä¸ªè§†é¢‘ </span>
						    </div>
						</div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label is-required">å•†å“ç›¸å†Œï¼š</label>
                            <div class="col-sm-7">
                                <input name="albumPics" class="form-control" type="hidden" th:field="*{albumPics}">
                                <ul class="ft-uploader__files" id="albumPicsImg" style="margin-top: 10px;">
                                    <!-- å›¾ç‰‡å±•ç¤º -->
                                </ul>
                                <div class="ft-uploader__input-box" id="albumPicsBox">
                                    <button id="albumPicsBtn" type="button" class="ft-uploader__input"></button>
                                </div>
                                <span class="help-block m-b-none" style="clear: both;"><i class="fa fa-info-circle"></i> å•†å“è¯¦æƒ…ä¸­è½®æ’­å›¾ </span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label ">è¯¦æƒ…é¡µæ ‡é¢˜ï¼š</label>
                            <div class="col-sm-6">
                                <input name="detailTitle" class="form-control" type="text" th:field="*{detailTitle}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label ">è¯¦æƒ…é¡µæè¿°ï¼š</label>
                            <div class="col-sm-6">
                                <input name="detailDesc" class="form-control" type="text" th:field="*{detailDesc}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">å•†å“è¯¦æƒ…è§†é¢‘ï¼š</label>
                            <div class="col-sm-6">
                                <input name="detailVideo" class="form-control" type="hidden" th:field="*{detailVideo}">
                                <ul class="ft-uploader__files" id="detailVideoShow" style="margin-top: 10px;">
                                    <!-- å›¾ç‰‡å±•ç¤º -->
                                </ul>
                                <div class="ft-uploader__input-box" id="detailVideoBox">
                                    <button id="detailVideoBtn" type="button" class="ft-uploader__input"></button>
                                </div>
                                <span class="help-block m-b-none" style="clear: both;"><i class="fa fa-info-circle"></i> å•†å“è¯¦æƒ…ä¸­è§†é¢‘ </span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label is-required">è¯¦æƒ…ç½‘é¡µå†…å®¹ï¼š</label>
                            <div class="col-sm-6">
                                <input name="detailHtml" id="detailHtml" class="form-control" type="hidden" th:field="*{detailHtml}">
                                <div class="summernote"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--æ­¥éª¤4-->
                <div id="page4" class="stepPage">
                    <div class="row article-title" id="step-4">
                        <div class="ibox text-center col-sm-8 col-md-offset-2">
                            <h1 class="ibox-title">æ­å–œæ‚¨ï¼Œå•†å“ç¼–è¾‘å®Œæˆï¼</h1>
                            <div class="ibox-content">
                                <span style="color: #257fd8;font-size: 160px;" class="glyphicon glyphicon-ok"
                                      aria-hidden="true"></span><br>
                                <button type="button" class="btn-primary btn m-t-lg" id="submitAuditBtn">æäº¤å¹³å°å®¡æ ¸</button>
                                <button type="button" class="btn-primary btn m-t-lg" id="returnListBtn">è¿”å›å•†å“åˆ—è¡¨</button>
<!--                                <button type="button" class="btn-primary btn m-t-lg" id="relodBtn">ç»§ç»­æ·»åŠ å•†å“</button>-->
                            </div>
                        </div>
                    </div>
                </div>
                <!--ä¸Šä¸€æ­¥,ä¸‹ä¸€æ­¥æŒ‰é’®-->
                <div class="step-button" style="text-align: center;">
                    <button type="button" class="btn btn-success prevBtn" id="prevBtn">ä¸Šä¸€æ­¥<span></span></button>
                    <button type="button" class="btn btn-success nextBtn" id="nextBtn">ä¸‹ä¸€æ­¥<span></span></button>
                </div>
            </div>
        </div>
    </form>
</div>
<th:block th:include="include :: footer"/>
<th:block th:include="include :: select2-js"/>
<th:block th:include="include :: jquery-setSetp-js"/>
<th:block th:include="include :: layui-all-js"/>
<th:block th:include="include :: summernote-js"/>
<script type="text/javascript" th:inline="javascript">
    //è·å–reqä¸­ä¼ å›æ¥çš„å•†å“å¯¹è±¡
    var productResult = [[${pmsProduct}]];
    //ajaxæäº¤å®¡å…¨éƒ¨åŒæ­¥è¿›è¡Œ
    $.ajaxSettings.async = false;
    //å±æ€§ç±»å‹
    var attrType = [[${@custom.getPmsAttrCategory()}]];
    //å‰ç¼€
    var prefix = ctx + "business/pmsProduct";
    //å›¾ç‰‡ä¸Šä¼ æ•°é‡æ§åˆ¶
    var picLimit= 1 , albumPicsLimit = [[${@config.getKey('biz.product.album')}]];
	var videoLimit= 1;
    //è¿”å›ç»“æœå‚æ•°åˆå§‹åŒ–
    var pmsProductParam = {};
    //å­˜æ”¾æ‰€æœ‰é”®å’Œå€¼çš„å¯¹è±¡ key:å±æ€§æ ‡ç­¾å¯¹è±¡  value:å€¼çš„æ•°ç»„  length:å€¼çš„æ•°é‡
    var mapList = [];
    //æ­£æ•´æ•°5ä»¥å†…
    var sortRexExp = ftConsts.regExp.sort;
    //ä»·æ ¼
    var priceRexExp = ftConsts.regExp.price;
    //åŸæœ‰çš„è§„æ ¼å±æ€§{é¢œè‰²: "çº¢è‰²,ç™½è‰²,é»‘è‰²,è“è‰²", å†…å­˜å®¹é‡: "3G,4G,6G,32G", å­˜å‚¨ç©ºé—´: "32G,64G,128G", ç½‘ç»œ: null}
    var inputMap={};
    //åˆå§‹åŒ–å•†å“ä¿¡æ¯
    function initProduct(){
        //åˆå§‹åŒ–æ”¯ä»˜æ–¹å¼
        var paymentType = $("input[name='paymentType']").val();
        console.log("paymentType="+paymentType)
        if(paymentType=='1'){
            //è®¾ç½®é€‰ä¸­
            $("input:radio[value='1']").attr('checked','true');
            //éšè—å®šé‡‘
            $("#deposit0").hide();
        }else if(paymentType=='2'){
            //è®¾ç½®é€‰ä¸­
            $("input:radio[value='2']").attr('checked','true');
            //æ˜¾ç¤ºå®šé‡‘
            $("#deposit0").show();
        }


        //åˆ¤æ–­åˆ†ç±»/å“ç‰Œæ˜¯å¦è¢«åˆ é™¤
        var cate = $.common.isEmpty($("select[name='productCategoryId']").val());
        var brand = $.common.isEmpty($("select[name='brandId']").val());
        var msg="";
        if(cate){
            msg+="[åˆ†ç±»]";
            $("select[name='productCategoryId']").val([""]).trigger("change");
        }
        if(brand){
            msg+="[å“ç‰Œ]";
            $("select[name='brandId']").val([""]).trigger("change");
        }
        if(msg){
            $.modal.alertWarning($.common.sprintf("æ­¤å•†å“çš„ %s è¢«ç¦ç”¨,è¯·é‡æ–°é€‰æ‹©ï¼",msg))
        }

        //åˆå§‹åŒ–æ¨èç±»å‹
        var recommendProductTypes = "";
        var recommends = productResult.smsHomeRecommendProductList;
        if(recommends.length>0){
            recommends.forEach(function (value, index, array) {
                recommendProductTypes+=value.type;
            })
        }
        $("input[name='recommendProductType']").each(function (index, value) {
            if(recommendProductTypes.indexOf($(value).val())!=-1){
                $(value).iCheck('check');
            }
        })
        //console.log(productResult)
        //åˆå§‹åŒ–è¿è´¹æ¨¡æ¿
        /*var pmsFeightTemplate = productResult.pmsFeightTemplate;
        if (pmsFeightTemplate) {
            var noDest = "æœªé€‰æ‹©åœ°åŒº",
                freeDest = pmsFeightTemplate.freeDest || noDest,
                tollDest = pmsFeightTemplate.tollDest || noDest,
                excludeDest = pmsFeightTemplate.excludeDest || noDest;
            var html = "", tpl = "<div class='row'><label class=\"col-sm-2 control-label\">%s</label><div class=\"col-sm-10\"><div class=\"form-control-static\">%s</div></div></div>";;
            html += $.common.sprintf(tpl, "åŒ…é‚®é…é€åŒºåŸŸï¼š", freeDest.replace(/,/g, "ã€"));
            html += $.common.sprintf(tpl, "ä¸åŒ…é‚®é…é€åŒºåŸŸï¼š", tollDest.replace(/,/g, "ã€"));
            html += $.common.sprintf(tpl, "ä¸é…é€åŒºåŸŸï¼š", excludeDest.replace(/,/g, "ã€"));
            $("select[name='feightTemplateId']").nextAll(".dest-show").html(html).removeClass("hidden");
        }*/
        // åˆå§‹åŒ–å•†å“å›¾ç‰‡ä¿¡æ¯
        var albumPics = $("input[name='albumPics']").val();
        var pic = $("input[name='pic']").val();
		var video = $("input[name='video']").val();
        var detailVideo = $("input[name='detailVideo']").val();
        initAlbumPics(albumPics);
        initPic(pic);
		initVideo(video);
        initDetailVideo(detailVideo);
        //å¯Œæ–‡æœ¬æ•°æ®å›æ˜¾çš„æ–¹æ³•åœ¨åˆå§‹åŒ–å¯Œæ–‡æœ¬æ’ä»¶ä¹‹å‰å®Œæˆ

        //å±æ€§å’Œå‚æ•° åˆå§‹åŒ–
        /**
         *  1. åˆ·æ–°å‡ºå•†å“å±æ€§è§„æ ¼çš„ åŸå§‹å±æ€§åˆ—è¡¨ å’Œ å‚æ•°åˆ—è¡¨
         *  2. æ›´æ–°å‡ºæ­¤å•†å“ç‰¹æœ‰çš„å±æ€§
         *  3. é€‰ä¸­æ­¤å•†å“çš„å±æ€§å€¼
         *  4. åˆå§‹åŒ– skuList_table
         *  5. å¡«å…… skulistçš„å€¼ å’Œ å‚æ•°åˆ—è¡¨ä¸­çš„å€¼
         */
        /**1. åˆ·æ–°å‡ºå•†å“å±æ€§è§„æ ¼çš„ åŸå§‹å±æ€§åˆ—è¡¨ å’Œ å‚æ•°åˆ—è¡¨*/
        var pmsAttrCategory = $("#pmsAttrCategory").val();
        autoProductCategory(pmsAttrCategory);
        /**2. æ›´æ–°å‡ºæ­¤å•†å“ç‰¹æœ‰çš„å±æ€§*/
        //--(1) è·å–åŸæœ‰çš„å±æ€§å€¼[inputMap] è·å– æ­¤å•†å“æ‰€æœ‰skuçš„å±æ€§å€¼[skuSpDateMap]
        //--(2) éå†æ­¤å•†å“å±æ€§çš„å€¼ ä¸ åŸæœ‰çš„å±æ€§çš„å€¼å¯¹æ¯”:
        //--         a.è‹¥æ­¤å•†å“å±æ€§å€¼,åœ¨åŸæœ‰å±æ€§å€¼ä¸­å­˜åœ¨,åˆ™çŠ¶æ€æ”¹ä¸ºé€‰ä¸­çŠ¶æ€
        //--         b.è‹¥æ­¤å•†å“å±æ€§å€¼,åœ¨åŸæœ‰å±æ€§å€¼ä¸­ä¸å­˜åœ¨,åˆ™æ·»åŠ æ­¤å±æ€§å€¼åˆ°é¡µé¢é€‰é¡¹å¹¶æ”¹ä¸ºé€‰ä¸­çŠ¶æ€
        //--         c.å…¶ä»–åŸæœ‰å±æ€§å€¼ä¸ç”¨ç®¡(é»˜è®¤ä¸é€‰ä¸­çŠ¶æ€)
        //==(1)è·å–æ­¤å•†å“æ‰€æœ‰skuçš„å±æ€§å€¼
        var skuList = productResult.skuList;
        //æ ¼å¼:{"pmsAttr@é¢œè‰²:ç™½è‰²,å†…å­˜å®¹é‡:3G[price]":2900,"pmsAttr@é¢œè‰²:ç™½è‰²,å†…å­˜å®¹é‡:3G[stock]":100...}
        var skuAttrInputValuesMap = {};
        if(skuList.length>0){
            //sp_Data {"é¢œè‰²":"é»‘è‰²","å†…å­˜å®¹é‡":"4G","å­˜å‚¨ç©ºé—´":"64G"} å’Œ {"é¢œè‰²":"é»‘è‰²","å†…å­˜å®¹é‡":"6G","å­˜å‚¨ç©ºé—´":"128G"}
            //éœ€è¦å¾—åˆ°  {é¢œè‰²:[é»‘è‰²] å†…å­˜å®¹é‡:[4G,6G] å­˜å‚¨ç©ºé—´:[64G,128G]}
            var skuSpDateMap = {};
            skuList.forEach(function (value, index, array) {
                //sp_Dataçš„JSONå¯¹è±¡ {"é¢œè‰²":"é»‘è‰²","å†…å­˜å®¹é‡":"4G","å­˜å‚¨ç©ºé—´":"64G"}
                //æŠŠskuå¯¹åº”çš„å±æ€§æ”¾å…¥skuSpDateMapä¸­
                //pmsAttr@é¢œè‰²:ç™½è‰²,å†…å­˜å®¹é‡:3G[price] = 2900;
                var nameStr = 'pmsAttr@' + value.spData.replace(/\"/g,"").replace(/{/g,"").replace(/}/g,"")+"[{col}]";
                skuAttrInputValuesMap[nameStr.replace(/{col}/g,'id')]=value.id;
                skuAttrInputValuesMap[nameStr.replace(/{col}/g,'price')]=value.price;
                skuAttrInputValuesMap[nameStr.replace(/{col}/g,'stock')]=value.stock;
                skuAttrInputValuesMap[nameStr.replace(/{col}/g,'lowStock')]=value.lowStock;
                skuAttrInputValuesMap[nameStr.replace(/{col}/g,'pic')]=value.pic;

                var spDataObj = jQuery.parseJSON(value.spData);
                //è‹¥ä¸ºç©º
                if($.common.isEmptyObject(skuSpDateMap)){
                    //[é¢œè‰²,å†…å­˜å®¹é‡,å­˜å‚¨ç©ºé—´]
                    Object.keys(spDataObj).forEach(function (value, index, array){
                        skuSpDateMap[value]=[spDataObj[value]];
                    });
                }else{
                    //[é¢œè‰²,å†…å­˜å®¹é‡,å­˜å‚¨ç©ºé—´]
                    Object.keys(spDataObj).forEach(function (value, index, array){
                        //è‹¥æ•°ç»„ä¸­ä¸åŒ…å«åˆ™æ·»åŠ åˆ°å€¼çš„æ•°ç»„ä¸­
                        if(skuSpDateMap[value].indexOf(spDataObj[value])==-1){
                            skuSpDateMap[value].push(spDataObj[value])
                        }
                    });
                }
            })

            //==(2) éå†æ­¤å•†å“å±æ€§çš„å€¼skuSpDateMap ä¸ åŸæœ‰çš„å±æ€§inputMapçš„å€¼å¯¹æ¯”:
            //skuSpDateMap : {é¢œè‰²:[é»‘è‰²] å†…å­˜å®¹é‡:[4G,6G] å­˜å‚¨ç©ºé—´:[64G,128G]}
            if(!$.common.isEmptyObject(skuSpDateMap)){
                //[é¢œè‰²,å†…å­˜å®¹é‡,å­˜å‚¨ç©ºé—´]
                Object.keys(skuSpDateMap).forEach(function (name, index, array){
                    //console.log(name,"-",inputMap[name]);
                    //--         a.è‹¥æ­¤å•†å“å±æ€§å€¼,åœ¨åŸæœ‰å±æ€§å€¼ä¸­å­˜åœ¨,åˆ™çŠ¶æ€æ”¹ä¸ºé€‰ä¸­çŠ¶æ€
                    //--         b.è‹¥æ­¤å•†å“å±æ€§å€¼,åœ¨åŸæœ‰å±æ€§å€¼ä¸­ä¸å­˜åœ¨,åˆ™æ·»åŠ æ­¤å±æ€§å€¼åˆ°é¡µé¢é€‰é¡¹å¹¶æ”¹ä¸ºé€‰ä¸­çŠ¶æ€
                    //--         c.å…¶ä»–åŸæœ‰å±æ€§å€¼ä¸ç”¨ç®¡(é»˜è®¤ä¸é€‰ä¸­çŠ¶æ€)
                    //[64G,128G] è‹¥å€¼ä¸ºç©ºåˆ™ä¸ç”¨å¾ªç¯åˆ¤æ–­
                    skuSpDateMap[name].forEach(function(val,i,arr){
                        //[8G,16G,32G,64G,128G].indexOf('64G')
                        if(inputMap[name] && inputMap[name].indexOf(val)>-1){
                            //a.è‹¥æ­¤å•†å“å±æ€§å€¼,åœ¨åŸæœ‰å±æ€§å€¼ä¸­å­˜åœ¨,åˆ™çŠ¶æ€æ”¹ä¸ºé€‰ä¸­çŠ¶æ€
                            //è·å–è¿™ä¸ªå€¼çš„input=checkBox
                            //æ‰¾åˆ°h4ä¸­html= å±æ€§åç§°(value)çš„å”¯ä¸€çˆ¶ç±»ä¸‹çš„input[value=(val)]å¯èƒ½æœ‰å¤šä¸ª,è·å–ç¬¬ä¸€ä¸ªçš„çˆ¶ç±»
                            $('div[name-value="'+name+'_'+val+'"]').addClass("checked");
                            $('input[name-value="'+name+'_'+val+'"]').val(val);
                        }else{
                            //b.è‹¥æ­¤å•†å“å±æ€§å€¼,åœ¨åŸæœ‰å±æ€§å€¼ä¸­ä¸å­˜åœ¨,åˆ™æ·»åŠ æ­¤å±æ€§å€¼åˆ°é¡µé¢é€‰é¡¹å¹¶æ”¹ä¸ºé€‰ä¸­çŠ¶æ€
                            addParam($('butten[data-title="'+name+'"]')[0],val);
                            $('div[name-value="'+name+'_'+val+'"]').addClass("checked");
                            $('input[name-value="'+name+'_'+val+'"]').val(val);
                        }
                    })
                });
            }
            updateTable();
            //4. åˆå§‹åŒ– skuList_table
            //name = pmsAttr@é¢œè‰²:ç™½è‰²,å†…å­˜å®¹é‡:3G[price]
            //ä»skuListä¸­è·å–sp_dataæ‹¼æˆ ğŸ‘† æ ¼å¼ ç„¶å,æ‰¾åˆ°input åˆå§‹åŒ–valueå€¼
            if(!$.common.isEmptyObject(skuAttrInputValuesMap)){
                Object.keys(skuAttrInputValuesMap).forEach(function(name,index,arr){
                    $('input[name="'+name+'"]').val(skuAttrInputValuesMap[name]);
                    if(name.indexOf("[pic]")>-1){
                        //åˆå§‹åŒ–skuå›¾ç‰‡
                        var tpl = "<li class=\"ft-uploader__file_sm\" style=\"background-image:url(" + respath + skuAttrInputValuesMap[name] + ")\" data-src=\"" + skuAttrInputValuesMap[name] + "\" ><img class=\"del-img\" src=\"../../../img/close.png\" /></li>";
                        $('input[name="'+name+'"]').next(".ft-uploader__files").append(tpl);
                        $('input[name="'+name+'"]').nextAll(".ft-uploader__input-box_sm").hide();
                    }
                });
            }
            //åˆ é™¤æ— ç”¨çš„skuè¡Œ
            $("input[name$='[price]']").each(function (index,value) {
                if(!$(value).val()){
                    $(value).parent().parent("tr").remove();
                }
            })
        }
        //åˆå§‹åŒ–å‚æ•°åˆ—è¡¨
        var pmsParamInputValuesMap = {};
        var paramDataObj = jQuery.parseJSON(productResult.paramData);
        Object.keys(paramDataObj).forEach(function(name,index,arr) {
            //pmsParam@æ¥å£ç±»å‹
            $('input[name="pmsParam@'+name+'"]').val(paramDataObj[name]);
        })
        //åˆå§‹åŒ–select2æ’ä»¶
        $("select[id^='paramSelect_']").each(function (index,value) {
            var paramName = $(value).attr("name").replace(/pmsParam@/g,"");
            var paramValue = paramDataObj[paramName];
            if(paramValue){
                var paramValueArr = paramValue.split(",");
                $(value).val(paramValueArr).trigger('change');
            }
        })
    }

    /**
     * å‚æ•°å€¼çš„é€‰æ‹©
     * {paramName} :å‚æ•°åç§°
     */
    var paramInputHtml = '<div class="form-group">\n' +
        '                    <label class="col-sm-3 control-label ">{paramName}ï¼š</label>\n' +
        '                    <div class="col-sm-6">\n' +
        '                    <input  name="pmsParam@{paramName}" class="paramValue form-control" type="text">\n' +
        '                    </div>\n' +
        '               </div>';
    /**
     * å‚æ•°å€¼çš„é€‰æ‹©
     * {option}:é€‰é¡¹
     * {paramName} :å‚æ•°åç§°
     * {id} :select æ ‡ç­¾çš„id
     */
    var paramSelectHtml = ' <div class="form-group">\n' +
        '                                    <label class="col-sm-3 control-label ">{paramName}ï¼š</label>\n' +
        '                                    <div class="col-sm-6">\n' +
        '                                        <select class="paramValue form-control m-b select2-multiple" id="paramSelect_{id}" name="pmsParam@{paramName}">\n' +
        '                                           {option}' +
        '                                        </select>\n' +
        '                                    </div>\n' +
        '                                </div>';

    /**
     * å±æ€§åˆ—è¡¨å†…å®¹
     * {cls} :checkMore / checkOne å•é€‰ /å¤šé€‰
     * {title} : æ­¤å±æ€§çš„åç§°
     * {val} : å±æ€§çš„å€¼
     * {checkHidden} : éšè— checkBox
     * {delHidden} : éšè— åˆ é™¤æŒ‰é’®
     * param_{id} : nameå±æ€§
     */
    var attrHtmlContext = '<div class="radio-box  {cls}">\n' +
        '                <div  name-value="{title}_{val}" class="icheckbox-blue">' +
        '<input name-value="{title}_{val}" type="hidden" name="lv2" value=""/>' +
        '<input type="checkbox" name="attrValue" value="{val}" style="position: absolute; opacity: 0;">' +
        '<ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; background: rgb(255, 255, 255); border: 0px; opacity: 0;"></ins>' +
        '</div>\n' +
        '   <label >{val}</label>\n' +
        '                <a class="del-radio-box {delHidden}">åˆ é™¤</a>' +
        '          </div>';

    /**
     * å±æ€§åˆ—è¡¨å¤´éƒ¨å†…å®¹
     * {title} : å•†å“è§„æ ¼åç§°
     * attr_{id} : è¿™ä¸ª ibox çš„å”¯ä¸€æ ‡è¯†
     */
    var attrHtmlStart = ' <div class="ibox lv1">\n' +
        '<div class="ibox-content attr_{id}">' +
        '<h4 class="lv1">{title}</h4>\n';

    /**
     * å±æ€§åˆ—è¡¨çš„ç»“å°¾å†…å®¹ 0->æ”¯æŒï¼›1->ä¸æ”¯æŒ
     * {cls} : æ–°å¢å±æ€§å€¼çš„æŒ‰é’®çš„å±æ€§
     * {title} : æŒ‰é’®æ‰€åœ¨çš„å±æ€§æ¨¡å—çš„åç§°
     */
    var attrHtmlEnd = '<div class="addParamInput">\n' +
        '            <input type="text" class="col-sm-3 form-control file-box m-t-xs"  name="addInput"/>\n' +
        '             <butten data-title="{title}" class="m-l-xs m-t-xxs btn btn-primary m-t-xs btn-sm {cls}">æ·»åŠ </butten>\n' +
        '              </div>\n' +
        '              </div>\n' +
        '            </div>';
    /**
     * skuä¸»å›¾ä¸Šä¼ æ‹¼è£…ç”¨çš„html
     */
    var skuPicUploadHtml ='<ul class="ft-uploader__files skuFiles"  style="margin-top: 10px;" >\n' +
        '                                    <!-- å›¾ç‰‡å±•ç¤º -->\n' +
        '                                </ul>\n' +
        '                                <div class="ft-uploader__input-box_sm">\n' +
        '                                    <button data-cls="upload_{ID}" type="button" class="ft-uploader__input skuUpload upload_{ID}" ></button>\n' +
        '                                </div>';

    /**************æ ¹æ®å±æ€§ç±»å‹ç”Ÿæˆè§„æ ¼é€‰æ‹©åˆ—è¡¨   å¼€å§‹**********************************/

    function autoProductCategory(pmsAttrCategory) {
        //å…ˆæ¸…ç©º
        $("#attrBox").empty();
        $("#paramsBox").empty();
        //éªŒè¯å‚æ•°
        if (!pmsAttrCategory) {
            $.modal.msg("è¯·å…ˆé€‰æ‹©è§„æ ¼ç±»å‹ï¼")
            return false;
        }
        //æŸ¥è¯¢åˆ°å±æ€§ç±»å‹
        var at = attrType.find(function (item) {
            return item.id == pmsAttrCategory;
        })

        //æ ¹æ®å±æ€§ç±»å‹è·å–å±æ€§åˆ—è¡¨å’Œå‚æ•°åˆ—è¡¨ -->å±æ€§çš„ç±»å‹ï¼›0->å±æ€§ï¼›1->å‚æ•°
        $.operate.get("/business/pmsProductAttribute/listByAttrCateId?attrCateId=" + at.id, function (res) {
            var list = res.rows;
            //åˆå§‹åŒ–å•†å“è§„æ ¼å€¼å¯¹è±¡
            inputMap={}
            list.forEach(function (item, index, arr) {
                //0->å±æ€§
                if (item.type == 0) {
                    //è®¾ç½®è§„æ ¼å±æ€§
                    inputMap[item.name]=item.inputList;
                    //å±æ€§åˆ—è¡¨çš„è‡ªåŠ¨ç”Ÿæˆ
                    $("#attrBox").append(autoAttrListHtml(item));
                }
                //1->å‚æ•°
                if (item.type == 1) {
                    autoParamListHtml(item);
                }
            });

        })
    }
 /**************æ ¹æ®å±æ€§ç±»å‹ç”Ÿæˆè§„æ ¼é€‰æ‹©åˆ—è¡¨   ç»“æŸ**********************************/
/*******************************æ ¹æ®æ¡ä»¶ç”Ÿæˆå±æ€§å’Œå‚æ•°åˆ—è¡¨  å¼€å§‹*****************************************************/
    //å‚æ•°åˆ—è¡¨è‡ªåŠ¨ç”Ÿæˆ
    function autoParamListHtml(item) {
        // console.log(item)
        //inputè¾“å…¥æ¡†
        var paramInputHtmlCon = paramInputHtml;
        var paramSelectHtmlCon = paramSelectHtml;
        //æ‰‹åŠ¨å½•å…¥
        if (item.inputType == 0) {
            $("#paramsBox").append(paramInputHtmlCon.replace(/{paramName}/g, item.name))
            return;
        }
        //ä»åˆ—è¡¨ä¸­é€‰æ‹©
        if (item.inputType == 1) {
            var data=[];
            var paramArr = item.inputList.split(',');
            for (var i = 0; i < paramArr.length; i++) {
                data.push({id:paramArr[i],text:paramArr[i]})
            }

            var html = paramSelectHtmlCon.replace(/{option}/g,'')
                .replace(/{paramName}/g, item.name)
                .replace(/{id}/g,item.id);

            $("#paramsBox").append(html)
            if(item.selectType==1){
                $("#paramSelect_"+item.id).select2({
                    placeholder: "",
                    data: data
                });
            }else if(item.selectType==2){
                $("#paramSelect_"+item.id).select2({
                    createSearchChoice:function(term, data) { if ($(data).filter(function() { return this.text.localeCompare(term)===0; }).length===0) {return {id:term, text:term};} },
                    multiple: true,
                    data: data
                });
            }
        }
    }

    //å±æ€§åˆ—è¡¨çš„è‡ªåŠ¨ç”Ÿæˆ
    function autoAttrListHtml(item) {
        //æ‹¼æ¥name = attr_id
        var attrHtmlCon = attrHtmlContext.replace(/{delHidden}/g, "delnohidden")
            .replace(/{id}/g, item.id)
            .replace(/{title}/g, item.name);
        var autoHtml = attrHtmlStart.replace(/{title}/g, item.name)
            .replace(/{id}/g, item.id);
        //åˆ¤æ–­å±æ€§å½•å…¥æ–¹å¼ï¼š0->æ‰‹å·¥å½•å…¥ å¹¶ä¸” ä¸æ”¯æŒæ‰‹åŠ¨æ–°å¢ï¼›
        if (item.inputType == 0 && item.handAddStatus != 0) {
            autoHtml += attrHtmlEnd.replace(/{cls}/g, "hidden")
                .replace(/{title}/g, item.name)
                .replace(/col-sm-3"/g, 'col-sm-8 lv2" maxLength="15"');
            return autoHtml;
        }
        //åˆ¤æ–­å±æ€§å½•å…¥æ–¹å¼ï¼š0->æ‰‹å·¥å½•å…¥ å¹¶ä¸” æ”¯æŒæ‰‹åŠ¨æ–°å¢ï¼›
        if (item.inputType == 0 && item.handAddStatus == 0) {
            autoHtml += attrHtmlEnd.replace(/{cls}/g, " addParamBtn handAdd")
                .replace(/{title}/g, item.name)
                .replace(/addInput/g, "lv2");
            return autoHtml;
        }
        //1->ä»åˆ—è¡¨ä¸­é€‰å–
        //0->å”¯ä¸€ï¼›1->å•é€‰ï¼›2->å¤šé€‰
        var st = item.selectType;
        if (item.inputType == 1) {
            if (st == 0) {
                //å”¯ä¸€
                autoHtml += attrHtmlCon.replace(/{val}/g, item.inputList.split(',')[0])
                    .replace(/delnohidden/g, "hidden")
                    .replace(/icheckbox-blue/g, '')
                    .replace(/lv2/g, '')
                    .replace(/attrValue/g, "lv2");
                return autoHtml + '</div></div>';
            }
            if (st == 1) {
                //å•é€‰ ä¸å¯åˆ é™¤
                item.inputList.split(',').forEach(function (value) {
                    autoHtml += attrHtmlCon.replace(/{val}/g, value)
                        .replace(/{cls}/g, 'checkOne');
                    // .replace(/delnohidden/g, "hidden");
                });
            }
            if (st == 2) {
                //å¤šé€‰
                item.inputList.split(',').forEach(function (value) {
                    autoHtml += (attrHtmlCon.replace(/{val}/g, value))
                        .replace(/{cls}/, 'checkMore');

                });
            }
        }
        //æ˜¯å¦æ”¯æŒæ‰‹åŠ¨æ–°å¢ï¼›0->æ”¯æŒï¼›1->ä¸æ”¯æŒ
        if (item.handAddStatus == 0) {
            autoHtml += attrHtmlEnd.replace(/{cls}/g, "addParamBtn st_" + st).replace(/{title}/g, item.name);
        } else {
            autoHtml = autoHtml.replace(/delnohidden/g, "hidden")
            autoHtml += '</div></div>';
        }
        return autoHtml;
    }
    /**
     * æ·»åŠ å±æ€§è§„æ ¼çš„å€¼
     * that : æ·»åŠ æŒ‰é’®
     * val : æ·»åŠ  çš„å€¼ è‹¥ä¸ºç©º åˆ™ä»thatå‰çš„inputè·å–
     */
    function addParam(that,val) {
        //console.log($(that))
        var attrHtmlx = attrHtmlContext;
        //ä¸èƒ½ä¸ºç©º
        if(!val){
            val = $(that).prev().val();
        }
        if (!val || val == '') {
            $.modal.msg("ä¸èƒ½æ·»åŠ ç©ºå±æ€§å€¼ï¼")
            return false;
        }
        if (val.length > 15) {
            $.modal.msg("å±æ€§å€¼æœ€å¤š15ä¸ªå­—ç¬¦ï¼")
            return false;
        }
        //éªŒè¯é‡å¤
        var flag = false;
        var $iboxContent = $(that).parent(".addParamInput").parent(".ibox-content");
        $iboxContent.find("label").each(function (index, item) {
            if ($(item).html() == val) {
                $.modal.msg("ä¸èƒ½æ·»åŠ é‡å¤å±æ€§å€¼ï¼")
                flag = true;
            }
        })
        //è·å–æ­¤å±æ€§çš„åç§°
        var name = $iboxContent.find("h4").html();
        //console.log("è·å–æ­¤å±æ€§çš„åç§°",name)
        if (flag) {
            return false;
        }
        //st_1å•é€‰  st_2å¤šé€‰
        var cls = "noCheck";
        if ($(that).hasClass("st_1")) {
            cls = "checkOne";
        }
        if ($(that).hasClass("st_2")) {
            cls = "checkMore";
        }
        //è·å–å®ƒä¸Šé¢çš„è¾“å…¥æ¡†çš„åˆ é™¤spanæ˜¯å¦hiddenå¦‚æœæœ‰åˆ™ä¹Ÿhidden å¦åˆ™ delnohidden
        var delFlag = 'delnohidden';
        if ($(that).parent(".addParamInput").prev().find(".del-radio-box").hasClass("hidden")) {
            delFlag = "hidden";
        }
        //æ‰‹åŠ¨å½•å…¥
        if ($(that).hasClass("handAdd")) {
            //ä¸æ˜¾ç¤ºé€‰æ‹©æ¡† æŠŠå€¼ä»˜ç»™lv2
            attrHtmlx = attrHtmlx.replace(/icheckbox-blue/g, 'icheckbox-blue hidden')
                .replace(/lv2/g, "")
                .replace(/attrValue/g, "lv2");
        }
        $(that).parent(".addParamInput").before(attrHtmlx.replace(/{val}/g, val)
            .replace(/{title}/g, name)
            .replace(/{cls}/g, cls)
            .replace(/{delHidden}/g, delFlag));
        $(that).prev().val("")
    }
 /*******************************æ ¹æ®æ¡ä»¶ç”Ÿæˆå±æ€§å’Œå‚æ•°åˆ—è¡¨  ç»“æŸ*****************************************************/

    /**
     * init
     */
    $(function () {
        //åˆå§‹åŒ–å‚æ•°
        initProduct();


        //ç›‘å¬å±æ€§ç±»å‹çš„æ”¹å˜
        $("#pmsAttrCategory").on("change", function () {
            autoProductCategory($(this).val());
        });

        //ç‚¹å‡»æ·»åŠ æŸä¸ªè§„æ ¼çš„å€¼
        $(document).on('click', '.addParamBtn', function(){
            addParam(this)
        });

        //ç‚¹å‡»åˆ é™¤é€‰é¡¹
        $(document).on('click', '.del-radio-box', function () {
            $(this).parent('.radio-box').remove()
        });
        //ç‚¹å‡»é€‰ä¸­è§„æ ¼çš„å€¼(å¤šé€‰)
        $(document).on('click', '.checkMore', function () {
            //å¦‚æœé€‰æ‹©ä¸­åˆ™å–æ¶ˆ åè€Œåä¹‹ åŒæ—¶ç»™lv2èµ‹å€¼æˆ–æ¸…é™¤
            var $check = $(this).children('.icheckbox-blue');
            if ($check.hasClass("checked")) {
                $check.removeClass("checked");
                $check.children('input[name="lv2"]').val('')
            } else {
                $check.addClass("checked");
                $check.children('input[name="lv2"]').val($check.children('input[name="attrValue"]').val())
            }
        });
        //ç›‘å¬ç‚¹å‡»æ—¶é—´åˆ·æ–°è¡¨æ ¼
        $(document).on('click', '#update_table', function (){
            $.modal.confirm("åˆ·æ–°åˆ—è¡¨å°†å¯¼è‡´skuä¿¡æ¯é‡æ–°ç”Ÿæˆï¼Œæ˜¯å¦è¦åˆ·æ–°ï¼Ÿ", function () {
                updateTable();
            })
        });
        //ç‚¹å‡»é€‰ä¸­è§„æ ¼çš„å€¼ï¼ˆå•é€‰ï¼‰
        $(document).on('click', '.checkOne', function () {
            //è·å–å…„å¼Ÿå…ƒç´ å–æ¶ˆé€‰ä¸­
            $(this).siblings(".radio-box").each(function (i, item) {
                $(item).children('.icheckbox-blue').removeClass("checked");
                $(item).children('.icheckbox-blue').children('input[name="lv2"]').val('')
            })
            //é€‰ä¸­è‡ªå·±
            var $check = $(this).children('.icheckbox-blue');
            $check.addClass("checked");
            $check.children('input[name="lv2"]').val($check.children('input[name="attrValue"]').val())
        });


        /**æœ€åä¸€é¡µ ä¸‰ä¸ªæŒ‰é’® é€‰é¡¹*/
        //è¿”å›å•†å“åˆ—è¡¨é¡µé¢
        $(document).on('click', '#returnListBtn', function () {
            var topWindow = $(window.parent.document);
            var currentId = $('.page-tabs-content', topWindow).find('.active').attr('data-panel');
            var tp = $('.RuoYi_iframe[data-id="' + currentId + '"]', topWindow)[0];
            if (tp) {
                var $contentWindow = tp.contentWindow;
                $.modal.close();
                $contentWindow.$(".layui-layer-padding").removeAttr("style");
                if ($contentWindow.table.options.type == table_type.bootstrapTable) {
                    $contentWindow.$.table.refresh();
                } else if ($contentWindow.table.options.type == table_type.bootstrapTreeTable) {
                    $contentWindow.$.treeTable.refresh();
                }
                $.modal.closeTab();
            } else {
                $.modal.parentTab('å•†å“ä¿¡æ¯', prefix + "/");
            }
        })
        //æäº¤å®¡æ ¸åè¿”å›å•†å“åˆ—è¡¨é¡µ
        $(document).on('click', '#submitAuditBtn', function () {
            //console.log(pmsProductParam)
            $.modal.parentTab('å•†å“ä¿¡æ¯', prefix + "/verify/" + pmsProductParam.id);
        })
        //æäº¤å®¡æ ¸åè¿”å›å•†å“åˆ—è¡¨é¡µ
        $(document).on('click', '#relodBtn', function () {
            window.location.reload();
        })

        //å¼¹å‡ºæç¤º
        $("[data-toggle='tooltip']").tooltip();
    })


    /**åˆ·æ–°è¡¨æ ¼*/
    function updateTable() {
        mapList = [];
        //è·å–æ‰€æœ‰çš„å±æ€§åç§°æ ‡ç­¾
        var $lv1Arr = $('h4.lv1');
        if (!$lv1Arr || $lv1Arr.length == 0) {
            $.modal.msg("è¯·é€‰æ‹©å®Œå–„çš„å±æ€§ç±»å‹.")
            $('#lv_table_con').hide();
            $('#lv_table').html('');
            return;
        }

        for (var i = 0; i < $lv1Arr.length; i++) {
            var lv2Arr = [];
            var lent = 0;
            //è·å–è¯¥lv1Arrä¸‹çš„æ‰€æœ‰å­˜æ”¾å€¼çš„input
            var $lv2Arr = $($lv1Arr[i]).parents('.lv1').find('input[name="lv2"]');
            $lv2Arr.each(function (index, item) {
                //å¦‚æœè¿™ä¸ªå€¼ä¸ä¸ºç©ºåˆ™å¡«å……
                if ($(item).val()) {
                    lent += 1;
                    lv2Arr.push($(item));
                }
            })
            if (lent != 0) {
                mapList.push({
                    key: $lv1Arr[i],
                    value: lv2Arr,
                    length: lent
                })
            }
        }
        if (!mapList || mapList.length == 0) {
            $.modal.msg("æ‚¨è¿˜æœªé€‰æ‹©ä»»ä½•å±æ€§å€¼.")
            $('#lv_table_con').hide();
            $('#lv_table').html('');
            return;
        }
        var tableHTML = '';
        tableHTML += '<table class="table table-bordered table-condensed table-hover">';
        tableHTML += '    <thead>';
        tableHTML += '        <tr>';
        for (var i = 0; i < mapList.length; i++) {
            tableHTML += '<th>' + $(mapList[i].key).html() + '</th>';
        }
        tableHTML += '            <th >ä»·æ ¼</th>';
        tableHTML += '            <th >åº“å­˜</th>';
        tableHTML += '            <th >åº“å­˜é¢„è­¦</th>';
        tableHTML += '            <th >å›¾ç‰‡</th>';
        tableHTML += '            <th >æ“ä½œ</th>';
        tableHTML += '        </tr>';
        tableHTML += '    </thead>';

        tableHTML += '    <tbody>';

        var numsArr = new Array();
        var idxArr = new Array();

        for (var i = 0; i < mapList.length; i++) {
            //å±æ€§çš„å€¼çš„æ•°é‡
            numsArr.push(mapList[i].length);
            idxArr[i] = 0;
        }

        var len = 1;
        var rowsArr = new Array();
        //éå†æ‰€æœ‰ å±æ€§ çš„ å€¼ çš„ æ•°é‡(æ•°é‡ä¸ä¸º0) (1,2)
        for (var i = 0; i < numsArr.length; i++) {
            len = len * numsArr[i];

            var tmpnum = 1;
            for (var j = numsArr.length - 1; j > i; j--) {
                tmpnum = tmpnum * numsArr[j];
            }
            rowsArr.push(tmpnum);
        }

        for (var i = 0; i < len; i++) {
            tableHTML += '        <tr data-row="' + (i + 1) + '">';

            var name = '';
            for (var j = 0; j < mapList.length; j++) {
                var n = parseInt(i / rowsArr[j]);
                if (j == 0) {
                } else if (j == mapList.length - 1) {
                    n = idxArr[j];
                    if (idxArr[j] + 1 >= numsArr[j]) {
                        idxArr[j] = 0;
                    } else {
                        idxArr[j]++;
                    }
                } else {
                    var m = parseInt(i / rowsArr[j]);
                    n = m % numsArr[j];
                }

                var textName = $(mapList[j].key).html();
                var text = $((mapList[j].value)[n]).val();
                if (j != mapList.length - 1) {
                    name += textName + ':' + text + ',';
                } else {
                    name += textName + ':' + text;
                }
                //åˆå¹¶å•å…ƒæ ¼
                //if (i % rowsArr[j] == 0) {
                    //tableHTML += '<td  rowspan="' + rowsArr[j] + '" data-rc="' + (i + 1) + '_' + (j + 1) + '">' + text + '</td>';
                    tableHTML += '<td   data-rc="' + (i + 1) + '_' + (j + 1) + '">' + text + '</td>';
                //}
            }
            tableHTML += '<td ><input maxlength="12"  type="hidden" name="pmsAttr@' + name + '[id]" /><input maxlength="12" style="width: 80px" type="text" name="pmsAttr@' + name + '[price]" /></td>';
            tableHTML += '<td ><input maxlength="5" style="width: 80px" type="text" name="pmsAttr@' + name + '[stock]" /></td>';
            tableHTML += '<td ><input maxlength="5" style="width: 80px" type="text" name="pmsAttr@' + name + '[lowStock]" /></td>';
            tableHTML += '<td ><input style="width: 80px" type="hidden" name="pmsAttr@' + name + '[pic]" />'+skuPicUploadHtml.replace(/{ID}/g, i)+'</td>';
            tableHTML += '<td ><a onclick="delSku(this)">åˆ é™¤</a></td>';
            tableHTML += '</tr>';
        }
        tableHTML += '</tbody>';
        tableHTML += '</table>';

        $('#lv_table_con').show();
        $('#lv_table').html(tableHTML);

        $(".skuUpload").each(function(index, elem) {
            var cls = $(elem).attr("data-cls");
            $.operate.layuiUpload("." + cls, ftConsts.upload.url.pc, 5000, ftConsts.upload.accept.images, function(r) {
                var tpl = "<li class=\"ft-uploader__file_sm\" style=\"background-image:url(" + respath + r.fileName + ")\" data-src=\"" + r.fileName + "\" ><img class=\"del-img\" src=\"../../../img/close.png\" /></li>";
                $(elem).parent(".ft-uploader__input-box_sm").prev(".ft-uploader__files").append(tpl);
                $(elem).parent(".ft-uploader__input-box_sm").prevAll("input").val(r.fileName);
                $(elem).parent(".ft-uploader__input-box_sm").hide();
            });
        });
    }

    /**
     *  åˆ é™¤sku
     */
    function delSku(that){
        $(that).parent().parent("tr").remove();
    }
    /**
     * åˆ†æ­¥æäº¤
     */
    var step = new SetStep({
        content: '.stepCont',
        fontWidth: 120,
        clickAble: false,
        steps: ['åŸºæœ¬ä¿¡æ¯', 'å±æ€§ä¿¡æ¯', 'é¡µé¢æ˜¾ç¤º', 'æ·»åŠ å®Œæˆ'],
        stepCounts: 4,
        curStep: 1,
        nextBtn: '#nextBtn',
        prevBtn: '#prevBtn',
        btnText: [' , å¡«å†™åŸºæœ¬ä¿¡æ¯', ' , å¡«å†™å±æ€§ä¿¡æ¯', ' , å¡«å†™é¡µé¢æ˜¾ç¤º', ' , æäº¤å•†å“ä¿¡æ¯'],
        onChangeBefore: function (index, btuFlag) {
            //è¿”å›ä¸Šä¸€é¡µä¸éœ€è¦éªŒè¯btuFlagï¼š-1 ä¸Šä¸€æ­¥ 1ä¸‹ä¸€æ­¥
            if (btuFlag === -1) {
                return true;
            }
            if ($.validate.form()) {
                if (index == 3) {
                    //æäº¤å‰éªŒè¯
                    if (!$("input[name='pic']").val()) {
                        $.modal.msgWarning("è¯·ä¸Šä¼ å•†å“ä¸»å›¾");
                        return false;
                    }
                    if (!$("input[name='albumPics']").val()) {
                        $.modal.msgWarning("è¯·ä¸Šä¼ è‡³å°‘1å¼ å•†å“ç›¸å†Œå›¾ç‰‡");
                        return false;
                    }
                    //ä¿å­˜å¯Œæ–‡æœ¬åˆ°éšè—åŸŸ;
                    var summernote = $('.summernote').summernote('code');
                    if (summernote=='<p><br></p>') {
                        $.modal.msgWarning("è¯¦æƒ…ç½‘é¡µå†…å®¹ä¸èƒ½ä¸ºç©ºï¼");
                        return false;
                    }
                    $("#detailHtml").val(summernote);

                    var bol = false;
                    $.modal.loading("æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å...");
                    layer.open({
                        content: "ç¡®è®¤è¦æäº¤å•†å“ä¿¡æ¯ï¼Ÿ"
                        ,btn: ['ç¡®å®š', 'å–æ¶ˆ']
                        ,yes: function(index,layero){
                            bol= true;
                            layer.close(index)
                        },
                        end:function(){
                            if(bol){
                                if (submitHandler()) {
                                    $(".step-button").addClass("hidden");
                                    step.goToNext(step);
                                }
                            }
                            $.modal.closeLoading();
                        }
                    });
                    return false;
                }else if(index == 2){
                    if(mapList.length == 0){
                        $.modal.msg("è¯·æ·»åŠ è‡³å°‘1æ¡å•†å“skuä¿¡æ¯.")
                        return false;
                    }
                    var errFlag=false;
                    //éªŒè¯ä»·æ ¼æ ¼å¼
                    $("input[name$='[price]']").each(function (index, value) {
                        //name = pmsAttr@é¢œè‰²:é‡‘ç°è‰²,å®¹é‡:300L[stock]
                        if (!(priceRexExp.test($(value).val()))) {
                            $(value).addClass("error")
                            errFlag = true;
                            return true;
                        }
                    })
                    //éªŒè¯åº“å­˜
                    $("input[name$='tock]']").each(function (index, value) {
                        //name = pmsAttr@é¢œè‰²:é‡‘ç°è‰²,å®¹é‡:300L[stock]
                        if (!(sortRexExp.test($(value).val()))) {
                            $(value).addClass("error")
                            errFlag = true;
                            return true;
                        }
                    })
                    if(errFlag){
                        $.modal.msg("skuåˆ—è¡¨æ•°æ®æ ¼å¼é”™è¯¯ï¼");
                        return false;
                    }
                }
                return true;
            } else {
                return false;
            }
        },
        onChangeAfter: function (index) {
            //æœ€åä¸€é¡µæ˜¾ç¤ºå®ŒæˆæŒ‰é’®
        }
    })

    /**æäº¤è¡¨å•*/
    function submitHandler() {

        if ($.validate.form()) {
            //è¿”å›çš„å‚æ•°æ•°æ®åŒ…è£…
            packageParam();
            console.log(pmsProductParam)
            /* pmsProductParam = {
                 productCategoryId: 9,
                 productAttributeCategoryId: 6,
                 name: "å•†å“åç§°22223",
                 subTitle: "å‰¯æ ‡é¢˜",
                 brandId: 3,
                 recommendProductType: "01,02,03",
                 description: "å•†å“ä»‹ç»å•†å“ä»‹ç»å•†å“ä»‹ç»å•†å“ä»‹ç»",
                 keywords: "é”®å­—",
                 price: 100,
                 originalPrice: 120,
                 stock: 999,
                 feightTemplateId: 2,
                 sort: 0,
                 pic: "",
                 albumPics: "ç”»å†Œå›¾ç‰‡,ç”»å†Œå›¾ç‰‡,ç”»å†Œå›¾ç‰‡",
                 detailTitle: "è¯¦æƒ…é¡µæ ‡é¢˜",
                 detailDesc: "è¯¦æƒ…é¡µæè¿°è¯¦æƒ…é¡µæè¿°è¯¦æƒ…é¡µæè¿°",
                 detailHtml: "<html>adf</html>",
                 paramData: '{"å•†å“è´§å·":"13123","å‚æ•°2":"param2"}',
                 skuList: [
                     {
                         spData: '{"åˆ—è¡¨å•é€‰z":"çº¢è‰²","åˆ—è¡¨å¤é€‰b":"aa","åˆ—è¡¨å”¯ä¸€b":"å”¯ä¸€é€‰æ‹©ä¸æ”¯æŒæ‰‹åŠ¨æ–°"}',
                         price: "1111",
                         stock: "111",
                         lowStock: "11",
                         pic: "1",
                     }
                 ]
             };*/
            var flag = true;
            var config = {
                url: prefix + "/edit",
                type: "post",
                async: false,
                dataType: "json",
                contentType: "application/json",
                data: JSON.stringify(pmsProductParam),
                beforeSend: function () {

                },
                success: function (result) {
                    if (result.code == web_status.SUCCESS) {
                        pmsProductParam.id = result.data;
                        $.modal.msgSuccess(result.msg);
                    }else{
                        $.modal.msgError(result.msg);
                        flag = false;
                    }
                    $.modal.closeLoading();
                }
            };
            $.ajax(config);
            return flag;
        }
    }
    /**
     * ç»„è£…æ•°æ®
     */
    function packageParam() {
        //æœ€åä¸€é¡µæ˜¾ç¤ºå¡«å†™çš„å•†å“è¡¨å•ä¿¡æ¯
        var dataArr = $('#form-pmsProduct-add').serializeArray();
        //ç»„è£…è¿”å›ç»“æœ
        var skuList = new Array();
        var recommendProductType = "";
        var paramData = {};
        dataArr.forEach(function (item, index) {
            //1. name = lv2 æˆ–è€… addInput å¿½ç•¥
            //2. name æ˜¯ä»¥pmsAttr@å¼€å¤´çš„æ˜¯å•†å“å±æ€§åˆ—è¡¨ å­˜å…¥sp_data(å•†å“é”€å”®å±æ€§ï¼Œjsonæ ¼å¼) ä»¥jsonå­—ç¬¦ä¸²æ ¼å¼
            //ä¾‹å¦‚:[{"key": "é¢œè‰²", "value": "é»‘è‰²" },{"key": "å®¹é‡","value": "32G"}
            //3. name æ˜¯ä»¥pmsParam@å¼€å¤´çš„æ˜¯å•†å“å‚æ•°åˆ—è¡¨ å­˜å…¥ paramDataä¸­ ä»¥jsonå­—ç¬¦ä¸²æ ¼å¼
            //4. å‰©ä½™çš„å­˜å…¥å•†å“è¡¨ç›¸åº”çš„å­—æ®µå³å¯(å•†å“æ¨èç±»å‹é€—å·æ‹¼æ¥)
            var name = item.name;
            var value = item.value;
            //æ— æ•ˆå€¼å¤„ç†
            if (name == 'lv2' || name == 'addInput') {
                return true
            }
            //skuå¤„ç†
            if (name.indexOf("pmsAttr@") == 0) {
                //console.log(name,"---",value)
                //pmsAttr@åˆ—è¡¨å•é€‰z:çº¢è‰²,åˆ—è¡¨å¤é€‰b:aa,åˆ—è¡¨å”¯ä¸€b:å”¯ä¸€é€‰æ‹©ä¸æ”¯æŒæ‰‹åŠ¨æ–°å¢[price]", value: "1111"
                var i = name.indexOf("[");
                var j = name.indexOf("@");
                // price
                var attrName = name.substring(i + 1, name.length-1);
                //åˆ—è¡¨å•é€‰z:çº¢è‰²,åˆ—è¡¨å¤é€‰b:aa,åˆ—è¡¨å”¯ä¸€b:å”¯ä¸€é€‰æ‹©ä¸æ”¯æŒæ‰‹åŠ¨æ–°å¢
                var pdatas = name.substring(j + 1, i);
                //{"åˆ—è¡¨å•é€‰z":"çº¢è‰²","åˆ—è¡¨å¤é€‰b":"aa","åˆ—è¡¨å”¯ä¸€b":"å”¯ä¸€é€‰æ‹©ä¸æ”¯æŒæ‰‹åŠ¨æ–°å¢"}
                pdatas = '{"' + pdatas.replace(/:/g, '":"').replace(/,/g, '","') + '"}';
                if (skuList.length > 0) {
                    for (var k = 0; k < skuList.length ; k++) {
                        var skuItem = skuList[k];
                        if (skuItem.spData == pdatas) {
                            skuItem[attrName] = value;
                            return true
                        }
                    }
                    var sku = {}
                    sku.spData = pdatas;
                    sku[attrName] = value;
                    skuList.push(sku);
                } else {
                    var sku = {}
                    sku.spData = pdatas;
                    sku[attrName] = value;
                    skuList.push(sku);
                }
                return true;
            }

            //å•†å“å‚æ•°å€¼å¤„ç†
            if (name.indexOf("pmsParam@") == 0) {
                //å¦‚æœå‚æ•°å€¼ä¸ºç©ºåˆ™ç›´æ¥å¿½ç•¥è¯¥å‚æ•°.
                if(!value){
                    return true;
                }
                //name:"pmsParam@å•†å“è´§å·", value: "é˜¿è¨å¾·"
                var i = name.indexOf("@");
                //å•†å“è´§å·
                var paramName = name.substring(i + 1);
                if ($.common.isEmptyObject(paramData)) {
                    //è‹¥ä¸ºç©º
                    paramData[paramName]=value;

                } else {
                    //è‹¥ä¸ä¸ºç©º
                    var keyArr = Object.keys(paramData);
                    for (var j = 0; j < keyArr.length; j++) {
                        if(keyArr[j] == paramName){
                            paramData[paramName] += ","+value;
                            return true
                        }
                    }
                    paramData[paramName]=value;
                }
                return true
            }
            //å•†å“æ¨èç±»å‹å¤„ç†
            if (name == "recommendProductType") {
                recommendProductType += "," + value;
            }
            //å…¶ä»–å‚æ•°æ”¾å…¥å•†å“å¯¹è±¡ä¸­
            pmsProductParam[name] = value;
        })

        //éœ€è¦æŠŠå•†å“å‚æ•°ä¸­valueæ·»åŠ ä¸Š{}å’Œå»æ‰å¤´éƒ¨çš„,
        pmsProductParam.paramData =  JSON.stringify(paramData);
        //å»æ‰æ¨èç±»å‹çš„ç¬¬ä¸€ä¸ªé€—å·
        if (recommendProductType) {
            pmsProductParam.recommendProductType = recommendProductType.substring(1);
        }
        //è®¾ç½®sku
        skuList.forEach(function (value, index, array) {
            array[index].pic = array[index].pic==''?pmsProductParam.pic:array[index].pic;
        })
        pmsProductParam.skuList = skuList;

    }
    /******************éªŒè¯ å¼€å§‹************************/
    $("#form-pmsProduct-add").validate({
        rules: {
            name: {
                required: true,
                maxlength: 50,
                remote: {
                    url: prefix + "/checkUnique",
                    type: "post",
                    dataType: "json",
                    data: {
                        "name": function () {
                            return $.common.trim($("input[name='name']").val());
                        },
                        "id": function () {
                            return $.common.trim($("input[name='id']").val());
                        }
                    },
                    dataFilter: function (data, type) {
                        return $.validate.unique(data);
                    }
                }
            },
            productCategoryId:{
                required: true,
            },
            albumPics:{
                required: true,
            },
            pic:{
                required: true,
            },
            subTitle:{
                required: true,
                maxlength: 100,
            },
            brandId:{
                required: true,
            },
            price: {
                required: true,
                isPrice: true,
            },
           /* feightTemplateId:{
                required: true,
            },*/
            productAttributeCategoryId: {
                required: true,
            },
            originalPrice: {
                required: true,
                isPrice: true,
            },
            stock: {
                required: true,
                positiveIntegerZero: true,
                maxlength: 5,
            },
            keywords: {
                maxlength: 20,
            },
            sort: {
                required: true,
                positiveIntegerZero: true,
                maxlength: 5,
            },
            description: {
                maxlength: 500,
            },
            skuPic: {
                required: true,
            },
            detailTitle: {
                maxlength: 20,
            },
            detailDesc: {
                maxlength: 20,
            },
            detailHtml: {
                required: true,
            },
            remark: {
                maxlength: 20
            },
        },
        messages: {
            name: {
                required: "åç§°ä¸èƒ½ä¸ºç©º ",
                maxlength: "æœ€å¤šè¾“å…¥50ä¸ªå­—. ",
                remote: "å•†å“åç§°å·²å­˜åœ¨ï¼ "
            },
            subTitle:{
                required: "å‰¯æ ‡é¢˜ä¸èƒ½ä¸ºç©º",
                maxlength: "æœ€å¤šè¾“å…¥100ä¸ªå­—. ",
            },
            productCategoryId:{
                required: "å•†å“åˆ†ç±»ä¸èƒ½ä¸ºç©º",
            },
            brandId:{
                required: "å•†å“å“ç‰Œä¸èƒ½ä¸ºç©º",
            },
            stock: {
                positiveIntegerZero: "åº“å­˜åªèƒ½è¾“å…¥æ­£æ•´æ•°. ",
                maxlength: "æœ€å¤§åº“å­˜ 99999 ",
            },
            /*feightTemplateId:{
                required: "è¿è´¹æ¨¡æ¿ä¸èƒ½ä¸ºç©º.",
            },*/
            productAttributeCategoryId: {
                required: "å±æ€§ç±»å‹ä¸èƒ½ä¸ºç©º.",
            },
            keywords: {
                maxlength: "æœ€å¤šè¾“å…¥20ä¸ªå­—. ",
            },
            pic: {
                required: "å•†å“ä¸»å›¾ä¸èƒ½ä¸ºç©º ",
            },
            albumPics:{
                required: "è‡³å°‘ä¸Šä¼ ä¸€å¼ å•†å“ç›¸å†Œ",
            },
            sort: {
                required: "åºå·ä¸èƒ½ä¸ºç©º ",
                positiveIntegerZero: "åºå·åªèƒ½æ˜¯æ­£æ•´æ•°",
                maxlength: "æœ€å¤šè¾“å…¥5ä½æ•°å­—",
            },
            description: {
                maxlength: "æœ€å¤šè¾“å…¥500ä¸ªå­—ç¬¦.",
            },
            remark: {
                maxlength: "æœ€å¤šè¾“å…¥20ä¸ªå­—ç¬¦.",
            },
        },
        focusCleanup: true
    })
    /******************éªŒè¯ ç»“æŸ************************/

    $('input:radio[name="paymentType0"]').change(function () {
        if ($("#paymentType1").is(":checked")) {
            $("#deposit0").hide();
        }
        if ($("#paymentType2").is(":checked")) {
            $("#deposit0").show();
        }
        $('#paymentType').val($("input[name='paymentType0']:checked").val());
    })


    /******************å›¾ç‰‡é€šç”¨ å¼€å§‹************************/
    /**å›¾ç‰‡é¢„è§ˆ--é€šç”¨ */
    $("body").on("click", ".ft-uploader__file", function (e) {
        if ($(this).attr("data-src")) {
            $.modal.preview(respath + $(this).attr("data-src"));
        }
    });

    $("body").on("click", ".ft-uploader__file_sm", function (e) {
        if ($(this).attr("data-src")) {
            $.modal.preview(respath + $(this).attr("data-src"));
        }
    });

    /**
     * æ”¶é›†å›¾ç‰‡--é€šç”¨
     * @param ulSelector æ˜¾ç¤ºå›¾ç‰‡çš„ul
     * @param inputSelector inputéšè—åŸŸ
     */
    function collectPic(ulSelector) {
        var arr = [];
        $(ulSelector + " li").each(function (index, elem) {
            arr.push($(elem).attr("data-src"));
        });
        return arr.join();
    }
    /******************å›¾ç‰‡é€šç”¨ ç»“æŸ************************/
    /******************å›¾ç‰‡åˆå§‹åŒ– å¼€å§‹************************/
    /**
     * åˆå§‹åŒ–å•†å“ä¸»å›¾
     */
    function initPic(pic) {
        if (pic) {
            var tpl = "<li class=\"ft-uploader__file\" style=\"background-image:url(" + respath + pic + ")\" data-src=\"" + pic + "\" ><img class=\"del-img\" src=\"../../../img/close.png\" /></li>";
            $("#picImg").append(tpl);
            picCtrl();
        }
    }
	/**
	 * åˆå§‹åŒ–å•†å“è§†é¢‘
	 */
	function initVideo(video) {
	    if (video) {
	        var tpl = "<li style=\"max-width:300px;position: relative;\" data-src=\"" + video + "\" ><video class=\"video\" src=\""+ respath + video +"\" controls=\"controls\" autoplay=\"autoplay\">æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ video æ ‡ç­¾ã€‚</video><img class=\"posImgDel del-img\" src=\"../../../img/close.png\" /></li>";
			$("#videoShow").append(tpl);
			videoCtrl();
	    }
	}
    function initDetailVideo(video) {
	    console.log("video="+video)
        if (video) {
            var tpl = "<li style=\"max-width:300px;position: relative;\" data-src=\"" + video + "\" ><video class=\"detailVideo\" src=\""+ respath + video +"\" controls=\"controls\" autoplay=\"autoplay\">æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ video æ ‡ç­¾ã€‚</video><img class=\"posImgDel del-img\" src=\"../../../img/close.png\" /></li>";
            $("#detailVideoShow").append(tpl);
            detailVideoCtrl();
        }
    }
    /**
     * åˆå§‹åŒ–å•†å“ç”»å†Œ
     */
    function initAlbumPics(albumPics) {
        if (albumPics && albumPics.split(",").length > 0) {
            var pics = albumPics.split(","), tpl = "";
            for (var i in pics) {
                tpl += "<li class=\"ft-uploader__file\" style=\"background-image:url(" + respath + pics[i] + ")\" data-src=\"" + pics[i] + "\" ><img class=\"del-img\" src=\"../../../img/close.png\" /></li>";
            }
            $("#albumPicsImg").html(tpl);
            albumPicsCtrl();
        }
    }
    /******************å›¾ç‰‡åˆå§‹åŒ– ç»“æŸ************************/
    /******************ä¸Šä¼ ä¸»å›¾ å¼€å§‹************************/
    /**
     * ä¸Šä¼ ä¸»å›¾
     */
    $.operate.layuiUpload("#picBtn", ftConsts.upload.url.pc, 5000, ftConsts.upload.accept.images, function(r) {
        var tpl = "<li class=\"ft-uploader__file\" style=\"background-image:url(" + respath + r.fileName + ")\" data-src=\"" + r.fileName + "\" ><img class=\"del-img\" src=\"../../../img/close.png\" /></li>";
        $("#picImg").append(tpl);
        $("input[name='pic']").val(collectPic("#picImg"));
        picCtrl();
    });

    // å•†å“ä¸»å›¾ä¸Šä¼ æ§åˆ¶
    function picCtrl() {
        $("#picImg li").length >= picLimit ? $("#picBox").hide() : $("#picBox").show();
    }

    // å•†å“ä¸»å›¾ä¸Šä¼ å›¾ç‰‡åˆ é™¤
    $("#picImg").on("click", ".del-img", function(e) {
        var self = this;
        $.modal.confirm("ç¡®è®¤åˆ é™¤å•†å“ä¸»å›¾å›¾ç‰‡ï¼Ÿ", function() {
            $(self).parent().remove();
            $("input[name='pic']").val(collectPic("#picImg"));
            picCtrl();
        });
        stopPropagation(e);
    });
    /******************ä¸Šä¼ ä¸»å›¾ ç»“æŸ************************/
	/******************ä¸Šä¼ è§†é¢‘****************************/
	/**
	 * ä¸Šä¼ è§†é¢‘
	 */
	$.operate.layuiUpload("#videoBtn", ftConsts.upload.url.pc, 5000, ftConsts.upload.accept.video, function(r) {
	    // var tpl = "<li class=\"ft-uploader__file\" style=\"background-image:url(" + respath + r.fileName + ")\" data-src=\"" + r.fileName + "\" ><img class=\"del-img\" src=\"../../../img/close.png\" /></li>";
	    var tpl = "<li style=\"max-width:300px;position: relative;\" data-src=\"" + r.fileName + "\" ><video class=\"video\" src=\""+ respath + r.fileName +"\" controls=\"controls\" autoplay=\"autoplay\">æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ video æ ‡ç­¾ã€‚</video><img class=\"posImgDel del-img\" src=\"../../../img/close.png\" /></li>";
	    $("#videoShow").append(tpl);
	    $("input[name='video']").val(collectPic("#videoShow"));
	    videoCtrl();
	});

    $.operate.layuiUpload("#detailVideoBtn", ftConsts.upload.url.pc, 5000, ftConsts.upload.accept.video, function(r) {
        // var tpl = "<li class=\"ft-uploader__file\" style=\"background-image:url(" + respath + r.fileName + ")\" data-src=\"" + r.fileName + "\" ><img class=\"del-img\" src=\"../../../img/close.png\" /></li>";
        var tpl = "<li style=\"max-width:300px;position: relative;\" data-src=\"" + r.fileName + "\" ><video class=\"detailVideo\" src=\""+ respath + r.fileName +"\" controls=\"controls\" autoplay=\"autoplay\">æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ video æ ‡ç­¾ã€‚</video><img class=\"posImgDel del-img\" src=\"../../../img/close.png\" /></li>";
        $("#detailVideoShow").append(tpl);
        $("input[name='detailVideo']").val(collectPic("#detailVideoShow"));
        detailVideoCtrl();
    });
	
	// å•†å“ä¸»å›¾ä¸Šä¼ æ§åˆ¶
	function videoCtrl() {
	    $("#videoShow li").length >= videoLimit ? $("#videoBox").hide() : $("#videoBox").show();
	}

    function detailVideoCtrl() {
        $("#detailVideoShow li").length >= videoLimit ? $("#detailVideoBox").hide() : $("#detailVideoBox").show();
    }
	
	// å•†å“ä¸»å›¾ä¸Šä¼ å›¾ç‰‡åˆ é™¤
	$("#videoShow").on("click", ".del-img", function(e) {
	    var self = this;
	    $.modal.confirm("ç¡®è®¤åˆ é™¤å•†å“å±•ç¤ºè§†é¢‘ï¼Ÿ", function() {
	        $(self).parent().remove();
	        $("input[name='video']").val(collectPic("#videoShow"));
	        videoCtrl();
	    });
	    stopPropagation(e);
	});
    $("#detailVideoShow").on("click", ".del-img", function(e) {
        var self = this;
        $.modal.confirm("ç¡®è®¤åˆ é™¤å•†å“è¯¦æƒ…å±•ç¤ºè§†é¢‘ï¼Ÿ", function() {
            $(self).parent().remove();
            $("input[name='detailVideo']").val(collectPic("#detailVideoShow"));
            detailVideoCtrl();
        });
        stopPropagation(e);
    });
	/*********************è§†é¢‘ ç»“æŸ********************************/
    /******************skuä¸»å›¾ å¼€å§‹************************/
    //skuä¸»å›¾ä¸Šä¼ å›¾ç‰‡åˆ é™¤
    $("body").on("click", ".skuFiles .del-img", function(e) {
        var self = this;
        $.modal.confirm("ç¡®è®¤åˆ é™¤SKUå›¾ç‰‡ï¼Ÿ", function() {
            $li = $(self).parent()
            $ul = $li.parent();
            $ul.prevAll("input").val("");
            $ul.nextAll(".ft-uploader__input-box_sm").show();
            $li.remove();
        });
        stopPropagation(e);
    });
    /******************ä¸Šä¼ ä¸»å›¾ ç»“æŸ************************/
    /******************ä¸Šä¼ å›¾å†Œ å¼€å§‹************************/
    // ä¸Šä¼ å•†å“ç›¸å†Œ
    $.operate.layuiUpload("#albumPicsBtn", ftConsts.upload.url.pc, 5000, ftConsts.upload.accept.images, function (r) {
        var tpl = "<li class=\"ft-uploader__file\" style=\"background-image:url(" + respath + r.fileName + ")\" data-src=\"" + r.fileName + "\" ><img class=\"del-img\" src=\"../../../img/close.png\" /></li>";
        $("#albumPicsImg").append(tpl);
        $("input[name='albumPics']").val(collectPic("#albumPicsImg"));
        albumPicsCtrl();
    });


    // å›¾å†Œä¸Šä¼ æ§åˆ¶
    function albumPicsCtrl() {
        $("#albumPicsImg li").length >= albumPicsLimit ? $("#albumPicsBox").hide() : $("#albumPicsBox").show();
    }

    // å›¾å†Œä¸Šä¼ å›¾ç‰‡åˆ é™¤
    $("#albumPicsImg").on("click", ".del-img", function (e) {
        var self = this;
        $.modal.confirm("ç¡®è®¤åˆ é™¤è¯¥èµ„æ–™å›¾ç‰‡ï¼Ÿ", function () {
            $(self).parent().remove();
            $("input[name='albumPics']").val(collectPic("#albumPicsImg"));
            albumPicsCtrl();
        });
        stopPropagation(e);
    });
    /******************ä¸Šä¼ å›¾å†Œ ç»“æŸ************************/
    /******************å¯Œæ–‡æœ¬ç¼–è¾‘ å¼€å§‹************************/
    //åˆå§‹åŒ–å¯Œæ–‡æœ¬
    $('.summernote').append( $("input[name='detailHtml']").val());
    $(".summernote").summernote({
        placeholder: 'è¯·å¡«å†™å›¾æ–‡å†…å®¹',
        height: 256,
        lang: 'zh-CN',
        followingToolbar: false,
        dialogsInBody: true,
        callbacks: {
            onImageUpload: function (files) {
                var len = files.length;
                for (var i = 0; i < len; i++) {
                    $.operate.summernoteImageUpload(files[i], this);
                }
            }
        }
    });
    /******************å¯Œæ–‡æœ¬ç¼–è¾‘ ç»“æŸ************************/

    /*$("select[name='feightTemplateId']").on('select2:select', function (e) {
        var val = $(this).val();
        var $destDivs = $(this).nextAll(".dest-show");
        $destDivs.addClass("hidden").html("");
        if (val) {
            var tpl = "<div class='row'><label class=\"col-sm-2 control-label\">%s</label><div class=\"col-sm-10\"><div class=\"form-control-static\">%s</div></div></div>";
            var noDest = "æœªé€‰æ‹©åœ°åŒº";
            $selected = $(this).find("option:selected"),
                freeDest = $selected.attr("data-free") || noDest,
                tollDest = $selected.attr("data-toll") || noDest,
                excludeDest = $selected.attr("data-exclude") || noDest;
            var html = "";
            html += $.common.sprintf(tpl, "åŒ…é‚®é…é€åŒºåŸŸï¼š", freeDest.replace(/,/g, "ã€"));
            html += $.common.sprintf(tpl, "ä¸åŒ…é‚®é…é€åŒºåŸŸï¼š", tollDest.replace(/,/g, "ã€"));
            html += $.common.sprintf(tpl, "ä¸é…é€åŒºåŸŸï¼š", excludeDest.replace(/,/g, "ã€"));
            $destDivs.html(html).removeClass("hidden");
        }
    });*/

</script>

</body>
</html>